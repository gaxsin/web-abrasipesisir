<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Sistem Peringatan Dini Abrasi Pesisir</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin:20px; }
    h1 { text-align:center; }
    .card { max-width:400px; margin:20px auto; padding:20px; border:1px solid #ccc; border-radius:10px; }
    label { display:block; margin-top:10px; }
    input { width:100%; padding:5px; margin-top:5px; }
    button { margin-top:15px; padding:10px 15px; cursor:pointer; }
    #banner-notif { display:none; margin-top:15px; background-color:#ff6961; color:white; text-align:center; padding:15px; font-weight:bold; }
    #map { height:400px; margin-top:20px; }
  </style>
</head>
<body>

  <h1>ðŸŒŠ Sistem Peringatan Dini Abrasi Pesisir</h1>

  <!-- Banner Notifikasi -->
  <div id="banner-notif">
    âš  Risiko Abrasi Tinggi! Harap waspada!
  </div>

  <div class="card">
    <label>Tinggi Gelombang (m)</label>
    <input type="number" id="gelombang" step="0.1">

    <label>Kecepatan Arus (m/s)</label>
    <input type="number" id="arus" step="0.1">

    <label>Pasang Surut (m)</label>
    <input type="number" id="pasut" step="0.1">

    <button onclick="hitungRisiko()">Cek Risiko Abrasi</button>
  </div>

  <button onclick="mintaIzinNotifikasi()">Aktifkan Notifikasi</button>

  <div id="map"></div>

  <!-- Leaflet Map + Script Risiko + OneSignal -->
  <script>
    // ======== Leaflet Map ========
    var map = L.map('map').setView([-0.9, 109.3], 7); // contoh koordinat Kalimantan Barat
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    // ======== Fungsi Risiko ========
    function hitungRisiko() {
      var gel = document.getElementById('gelombang').value;
      var arus = document.getElementById('arus').value;
      var pasut = document.getElementById('pasut').value;

      // âœ… Validasi input lengkap
      if(gel === "" || arus === "" || pasut === "") {
        alert("âš  Harap lengkapi semua data (Gelombang, Arus, Pasang Surut)!");
        document.getElementById('banner-notif').style.display = "none"; // sembunyikan banner
        return;
      }

      // Konversi ke angka
      gel = parseFloat(gel);
      arus = parseFloat(arus);
      pasut = parseFloat(pasut);

      // Hitung risiko
      var risiko = (gel>2 || arus>1.5 || pasut>1.5) ? "Tinggi" : "Normal";

      // Tampilkan banner jika tinggi
      document.getElementById('banner-notif').style.display = (risiko==="Tinggi") ? "block" : "none";

      alert("Risiko Abrasi: " + risiko);
    }

    // ======== OneSignal ========
    var OneSignal = window.OneSignal || [];
    OneSignal.push(function() {
      OneSignal.init({
        appId: "816b5b26-e157-4c9a-8949-02db1b526471", // Ganti dengan App ID asli
        notifyButton: { enable:true },
        welcomeNotification: {
          "title": "Fadil's Org App",
          "message": "Terima kasih sudah subscribe!"
        }
      });
    });

    function mintaIzinNotifikasi() {
      console.log("Tombol Aktifkan Notifikasi diklik");
      OneSignal.push(function() {
        OneSignal.showSlidedownPrompt();
      });
    }
  </script>

  <!-- OneSignal SDK -->
  <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script>

</body>
</html>
