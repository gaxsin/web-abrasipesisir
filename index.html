<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Sistem Peringatan Dini Abrasi Pesisir</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin:20px; }
    h1 { text-align:center; }
    .card { max-width:400px; margin:20px auto; padding:20px; border:1px solid #ccc; border-radius:10px; }
    label { display:block; margin-top:10px; }
    input { width:100%; padding:5px; margin-top:5px; }
    button { margin-top:15px; padding:10px 15px; cursor:pointer; }
    #banner-notif { display:none; margin-top:15px; background-color:#ff6961; color:white; text-align:center; padding:15px; font-weight:bold; }
    #map { height:400px; margin-top:20px; }
  </style>
</head>
<body>

<h1>ðŸŒŠ Sistem Peringatan Dini Abrasi Pesisir</h1>

<!-- Banner Notifikasi -->
<div id="banner-notif">
  âš  Risiko Abrasi Tinggi! Harap waspada!
</div>

<div class="card">
  <label>Tinggi Gelombang (m)</label>
  <input type="number" id="gelombang" step="0.1">

  <label>Kecepatan Arus (m/s)</label>
  <input type="number" id="arus" step="0.1">

  <label>Pasang Surut (m)</label>
  <input type="number" id="pasut" step="0.1">

  <button onclick="hitungRisiko()">Cek Risiko Abrasi</button>
</div>

<button onclick="aktifkanNotifikasi()">Aktifkan Notifikasi</button>

<div id="map"></div>

<!-- OneSignal SDK -->
<script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script>

<script>
  // ======== Inisialisasi OneSignal ========
  window.OneSignal = window.OneSignal || [];
  OneSignal.push(function() {
    OneSignal.init({
      appId: "YOUR_ONESIGNAL_APP_ID", // Ganti dengan App ID asli OneSignal
      notifyButton: { enable: true },
      welcomeNotification: {
        "title": "Fadil's Org App",
        "message": "Terima kasih sudah subscribe!"
      }
    });
  });

  function aktifkanNotifikasi() {
    OneSignal.push(function() {
      OneSignal.showSlidedownPrompt(); // munculkan prompt izin
    });
  }

  // ======== Fungsi Risiko ========
  function hitungRisiko() {
    let gel = document.getElementById("gelombang").value;
    let arus = document.getElementById("arus").value;
    let pasut = document.getElementById("pasut").value;

    // âœ… Validasi input lengkap
    if(gel === "" || arus === "" || pasut === "") {
      alert("âš  Harap lengkapi semua data (Gelombang, Arus, Pasang Surut)!");
      document.getElementById("banner-notif").style.display = "none";
      document.getElementById("hasil")?.remove();
      return;
    }

    gel = parseFloat(gel);
    arus = parseFloat(arus);
    pasut = parseFloat(pasut);

    // Hitung risiko (contoh ambang)
    let risiko = (gel>2 || arus>1.5 || pasut>1.5) ? "Tinggi" : "Rendah";

    // Tampilkan banner dan kirim notifikasi jika tinggi
    let banner = document.getElementById("banner-notif");
    if(risiko === "Tinggi") {
      banner.style.display = "block";
      OneSignal.push(function() {
        OneSignal.sendSelfNotification(
          "âš  Risiko Abrasi Tinggi!",
          "Gelombang atau arus tinggi terdeteksi, harap waspada!",
          window.location.href,
          'https://example.com/icon.png' // optional icon
        );
      });
      alert("âš  Risiko Abrasi: TINGGI");
    } else {
      banner.style.display = "none";
      alert("âœ… Risiko Abrasi: Rendah");
    }
  }

  // ======== Leaflet Map ========
  var map = L.map('map').setView([-0.7893, 113.9213], 5);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© OpenStreetMap'
  }).addTo(map);
</script>

</body>
</html>
